% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/audit-chapter.R
\name{audit_chapter}
\alias{audit_chapter}
\title{Audit the script-figure-slide dependency chain for a chapter}
\usage{
audit_chapter(
  chapter,
  lecture_dir = here::here(),
  lecture = basename(lecture_dir),
  pattern = "[.]R$",
  timeout = 300,
  run = TRUE,
  method = c("auto", "regex", "fls")
)
}
\arguments{
\item{chapter}{Character. Chapter directory name, e.g. \code{"evaluation"}.}

\item{lecture_dir}{Character. Path to the lecture directory.
Defaults to \code{here::here()}, i.e. the project root.}

\item{lecture}{Character. Lecture name for display purposes.
Defaults to \code{basename(lecture_dir)}.}

\item{pattern}{Regex pattern to filter scripts. Default \code{"[.]R$"}.}

\item{timeout}{Numeric. Per-script timeout in seconds. Default 300.}

\item{run}{Logical. If \code{TRUE} (default), execute scripts.
If \code{FALSE}, only perform static analysis (figure existence + slide references).}

\item{method}{Character. How to detect which figures slides reference:
\itemize{
\item \code{"auto"} (default): Use \code{.fls} files if they exist for all slides,
otherwise fall back to regex. Best for use after \verb{make slides}.
\item \code{"regex"}: Parse \code{.tex} source with regex. Fast but can miss
dynamically constructed paths (e.g. \verb{\\\\foreach} loops).
\item \code{"fls"}: Parse \code{.fls} recorder files from \code{latexmk}. More robust
but requires prior compilation (\verb{make slides}). Errors if \code{.fls}
files are missing.
}}
}
\value{
Invisibly: A list with components:
\itemize{
\item \code{scripts}: data.frame of scripts. Includes \code{success}, \code{error_message},
\code{elapsed}, and \code{figures_produced} columns when \code{run = TRUE} (\code{NA} otherwise).
\item \code{figures}: data.frame of figure files on disk (from \verb{figure/})
\item \code{figures_man}: data.frame of manually created figure files (from \verb{figure_man/})
\item \code{slide_refs}: named list mapping slide filenames to their \verb{figure/} references
\item \code{slide_refs_man}: named list mapping slide filenames to their \verb{figure_man/} references
\item \code{orphaned_figures}: character vector of \verb{figure/} filenames (with extension)
not used by any slide (excludes \verb{attic/} subdirectory)
\item \code{orphaned_figures_man}: character vector of \verb{figure_man/} filenames (with
extension) not used by any slide (excludes \verb{attic/} subdirectory)
\item \code{attic_figures}: character vector of filenames in \verb{figure/attic/}
\item \code{attic_figures_man}: character vector of filenames in \verb{figure_man/attic/}
\item \code{orphaned_scripts}: character vector of script filenames that succeeded
but produced no figure used by any slide (\code{NULL} if \code{run = FALSE})
\item \code{failed_scripts}: character vector of script filenames that errored
during execution (\code{NULL} if \code{run = FALSE})
\item \code{no_figure_scripts}: character vector of script filenames that succeeded
but produced no figures (\code{NULL} if \code{run = FALSE})
\item \code{missing_figures}: data.frame with columns \code{figure} and \code{slide} for
\verb{figure/} files referenced by slides but not on disk
\item \code{missing_figures_man}: data.frame with columns \code{figure} and \code{slide} for
\verb{figure_man/} files referenced by slides but not on disk
\item \code{missing_pkgs}: character vector of R packages required by scripts
but not currently installed
}
}
\description{
Performs a comprehensive audit of a lecture chapter:
\enumerate{
\item Discovers scripts in \verb{rsrc/}, figures in \verb{figure/}, and slide \code{.tex} files
\item Parses slides to find which figures they reference
\item Optionally runs all scripts and tracks which figures they produce
\item Cross-references to identify orphaned figures, orphaned scripts,
and missing figures
}
}
\examples{
\dontshow{if (fs::dir_exists(here::here("lecture_i2ml"))) withAutoprint(\{ # examplesIf}
# Static audit only (no script execution)
result <- audit_chapter("evaluation",
  lecture_dir = here::here("lecture_i2ml"),
  run = FALSE
)
result$orphaned_figures
result$missing_figures

\dontrun{
# Full audit with script execution
result <- audit_chapter("evaluation",
  lecture_dir = here::here("lecture_i2ml")
)
}
\dontshow{\}) # examplesIf}
}
